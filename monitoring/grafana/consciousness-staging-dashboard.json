{
  "dashboard": {
    "id": null,
    "title": "Consciousness System - Staging Dashboard",
    "tags": ["consciousness", "staging", "quantum", "resonance", "websocket"],
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "refresh": "30s",
    "panels": [
      {
        "id": 1,
        "type": "stat",
        "title": "API Health Status",
        "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
        "targets": [
          {
            "expr": "probe_success{job=\"sigil-api-readyz\"}",
            "legendFormat": "Readiness"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "red", "value": 0},
                {"color": "green", "value": 1}
              ]
            },
            "mappings": [
              {"options": {"0": {"text": "DOWN"}}, "type": "value"},
              {"options": {"1": {"text": "UP"}}, "type": "value"}
            ]
          }
        }
      },
      {
        "id": 2,
        "type": "stat",
        "title": "Active WS Connections",
        "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0},
        "targets": [
          {
            "expr": "spiral_ws_active_connections",
            "legendFormat": "Connections"
          }
        ]
      },
      {
        "id": 3,
        "type": "stat",
        "title": "API 5xx Errors (5m)",
        "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
        "targets": [
          {
            "expr": "increase(api_5xx_errors_total[5m])",
            "legendFormat": "5xx Count"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 5},
                {"color": "red", "value": 20}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "type": "stat",
        "title": "WS Heartbeat Skew P95 (ms)",
        "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(heartbeat_skew_ms_bucket[5m])) by (le))",
            "legendFormat": "P95 Skew"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 100},
                {"color": "red", "value": 200}
              ]
            }
          }
        }
      },
      {
        "id": 5,
        "type": "timeseries",
        "title": "Quantum & Resonance API Request Rates",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4},
        "targets": [
          {
            "expr": "rate(quantum_stats_requests_total[5m])",
            "legendFormat": "Quantum Stats"
          },
          {
            "expr": "rate(resonance_stats_requests_total[5m])",
            "legendFormat": "Resonance Stats"
          }
        ]
      },
      {
        "id": 6,
        "type": "timeseries",
        "title": "Phase A Feature Request Rates",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4},
        "targets": [
          {
            "expr": "rate(consciousness_os_requests_total[5m])",
            "legendFormat": "Consciousness OS"
          },
          {
            "expr": "rate(universal_protocol_requests_total[5m])",
            "legendFormat": "Universal Protocol"
          },
          {
            "expr": "rate(transcendent_requests_total[5m])",
            "legendFormat": "Transcendent Engine"
          }
        ]
      },
      {
        "id": 7,
        "type": "timeseries",
        "title": "Operation Latencies (P95)",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 12},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(quantum_operation_duration_seconds_bucket[5m])) by (le))",
            "legendFormat": "Quantum P95"
          },
          {
            "expr": "histogram_quantile(0.95, sum(rate(resonance_operation_duration_seconds_bucket[5m])) by (le))",
            "legendFormat": "Resonance P95"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s"
          }
        }
      },
      {
        "id": 8,
        "type": "timeseries",
        "title": "WebSocket Message Flow",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 12},
        "targets": [
          {
            "expr": "rate(ws_messages_in_total[5m])",
            "legendFormat": "Messages In/sec"
          },
          {
            "expr": "rate(ws_messages_out_total[5m])",
            "legendFormat": "Messages Out/sec"
          },
          {
            "expr": "rate(ws_bytes_out_total[5m])",
            "legendFormat": "Bytes Out/sec"
          }
        ]
      },
      {
        "id": 9,
        "type": "timeseries",
        "title": "WebSocket Drops & Errors",
        "gridPos": {"h": 6, "w": 8, "x": 0, "y": 20},
        "targets": [
          {
            "expr": "rate(ws_backpressure_drops_total[5m])",
            "legendFormat": "Backpressure Drops/sec"
          },
          {
            "expr": "rate(ws_rate_limit_drops_total[5m])",
            "legendFormat": "Rate Limit Drops/sec"
          }
        ]
      },
      {
        "id": 10,
        "type": "timeseries",
        "title": "Process Memory Usage",
        "gridPos": {"h": 6, "w": 8, "x": 8, "y": 20},
        "targets": [
          {
            "expr": "process_heap_used_bytes / (1024 * 1024)",
            "legendFormat": "Heap Used (MB)"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "bytes"
          }
        }
      },
      {
        "id": 11,
        "type": "timeseries",
        "title": "Module Initialization Failures",
        "gridPos": {"h": 6, "w": 8, "x": 16, "y": 20},
        "targets": [
          {
            "expr": "increase(optional_module_init_failures_total[10m])",
            "legendFormat": "Init Failures (10m)"
          }
        ]
      },
      {
        "id": 12,
        "type": "table",
        "title": "Current Alert Status",
        "gridPos": {"h": 6, "w": 24, "x": 0, "y": 26},
        "targets": [
          {
            "expr": "ALERTS{alertstate=\"firing\", component=~\"api|websocket|consciousness\"}",
            "legendFormat": "{{alertname}} - {{severity}}"
          }
        ]
      }
      ,{
        "id": 13,
        "type": "timeseries",
        "title": "CNPL Compile/Execute Rates",
        "gridPos": {"h": 6, "w": 12, "x": 0, "y": 32},
        "targets": [
          { "expr": "rate(cnpl_compile_requests_total[5m])", "legendFormat": "Compile/sec" },
          { "expr": "rate(cnpl_execute_requests_total[5m])", "legendFormat": "Execute/sec" }
        ]
      }
      ,{
        "id": 14,
        "type": "timeseries",
        "title": "SAQRN Publish/Subscribe Rates",
        "gridPos": {"h": 6, "w": 12, "x": 12, "y": 32},
        "targets": [
          { "expr": "rate(saqrn_publish_requests_total[5m])", "legendFormat": "Publish/sec" },
          { "expr": "rate(saqrn_subscribe_requests_total[5m])", "legendFormat": "Subscribe/sec" }
        ]
      }
    ]
  }
}