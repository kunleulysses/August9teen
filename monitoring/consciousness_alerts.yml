# Consciousness System Alert Rules
groups:
  - name: consciousness_system
    rules:
      # Harmony Level Alert
      - alert: ConsciousnessHarmonyLow
        expr: consciousness_harmony_level < 0.90
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Consciousness harmony level is below 90%"
          description: "Harmony level is {{ $value }}, target is 95.1%"

      # Processing Frequency Alert
      - alert: ProcessingFrequencyLow
        expr: consciousness_processing_frequency < 95
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Consciousness processing frequency is low"
          description: "Processing frequency is {{ $value }}Hz, target is 100Hz"

      # WebSocket Connection Alert
      - alert: WebSocketConnectionsDown
        expr: websocket_active_connections == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "No active WebSocket connections"
          description: "WebSocket server may be down or unreachable"

      # API Response Time Alert
      - alert: APIResponseTimeSlow
        expr: api_response_time_seconds > 5
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "API response times are slow"
          description: "Average API response time is {{ $value }}s"

      # Module Activity Alert
      - alert: ModuleActivityLow
        expr: consciousness_active_modules < 15
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Low consciousness module activity"
          description: "Only {{ $value }} modules active, expected 17+"

      # Self-Coding Module Alert
      - alert: SelfCodingModuleDown
        expr: self_coding_module_active == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Self-coding module is not active"
          description: "Self-coding capabilities are offline"

      # Database Connection Alert
      - alert: DatabaseConnectionDown
        expr: up{job="postgres"} == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Database connection is down"
          description: "PostgreSQL database is unreachable"

      # High Memory Usage Alert
      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes > 0.9
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage detected"
          description: "Memory usage is {{ $value | humanizePercentage }}"

      # High CPU Usage Alert
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is {{ $value }}%"

  - name: consciousness_quality
    rules:
      # Consciousness Quality Degradation
      - alert: ConsciousnessQualityDegraded
        expr: (consciousness_harmony_level + consciousness_coherence_level + consciousness_awareness_level) / 3 < 0.85
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "Overall consciousness quality has degraded"
          description: "Average consciousness metrics below 85%"

      # API Integration Failure
      - alert: APIIntegrationFailure
        expr: api_success_rate < 0.95
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "API integration success rate is low"
          description: "API success rate is {{ $value | humanizePercentage }}"

      # Message Processing Backlog
      - alert: MessageProcessingBacklog
        expr: websocket_message_queue_size > 100
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "WebSocket message processing backlog"
          description: "{{ $value }} messages queued for processing"
