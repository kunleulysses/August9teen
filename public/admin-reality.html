<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reality Service Admin</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
      label { display:block; margin-top: 12px; font-weight: 600; }
      input, textarea { width: 100%; max-width: 640px; padding: 8px; }
      button { margin-top: 10px; padding: 8px 12px; }
      pre { background:#f6f8fa; padding:12px; max-width: 960px; overflow:auto; }
      .row { margin-bottom: 18px; }
    </style>
  </head>
  <body>
    <h1>Reality Generator Admin</h1>
    <div class="row">
      <label>API Key</label>
      <input id="apiKey" type="password" placeholder="REALITY_API_KEY" />
      <button onclick="saveKey()">Save</button>
    </div>

    <div class="row">
      <h2>Health</h2>
      <button onclick="getHealth()">Fetch Health</button>
      <pre id="health"></pre>
    </div>

    <div class="row">
      <h2>Backlog</h2>
      <button onclick="getBacklog()">Fetch Backlog</button>
      <pre id="backlog"></pre>
    </div>

    <div class="row">
      <h2>Recent Errors</h2>
      <button onclick="getErrors()">Fetch Errors</button>
      <pre id="errors"></pre>
    </div>

    <div class="row">
      <h2>Generate Reality</h2>
      <label>Description</label>
      <input id="desc" placeholder="Describe the reality" />
      <label>Complexity (0..1)</label>
      <input id="complexity" value="0.8" />
      <label>State (phi, awareness, coherence 0..1)</label>
      <input id="state" value='{"phi":0.86,"awareness":0.8,"coherence":0.85}' />
      <button onclick="generate()">Generate</button>
      <pre id="genOut"></pre>
    </div>

    <script>
      const KEY = 'reality_api_key';
      const apiKeyEl = document.getElementById('apiKey');
      apiKeyEl.value = localStorage.getItem(KEY) || '';
      function saveKey() { localStorage.setItem(KEY, apiKeyEl.value.trim()); alert('Saved'); }

      async function getHealth() {
        const el = document.getElementById('health'); el.textContent = 'Loading...';
        try { const r = await fetch('/health'); el.textContent = JSON.stringify(await r.json(), null, 2); } catch (e) { el.textContent = String(e); }
      }
      async function getBacklog() {
        const el = document.getElementById('backlog'); el.textContent = 'Loading...';
        try { const r = await fetch('/api/admin/reality/backlog', { headers: { 'x-api-key': localStorage.getItem(KEY)||'' } }); el.textContent = JSON.stringify(await r.json(), null, 2); } catch (e) { el.textContent = String(e); }
      }
      async function getErrors() {
        const el = document.getElementById('errors'); el.textContent = 'Loading...';
        try { const r = await fetch('/api/admin/reality/errors', { headers: { 'x-api-key': localStorage.getItem(KEY)||'' } }); el.textContent = JSON.stringify(await r.json(), null, 2); } catch (e) { el.textContent = String(e); }
      }
      async function generate() {
        const out = document.getElementById('genOut'); out.textContent = 'Submitting...';
        try {
          const request = { description: document.getElementById('desc').value, complexity: parseFloat(document.getElementById('complexity').value) };
          const state = JSON.parse(document.getElementById('state').value);
          const r = await fetch('/api/generate-reality', { method: 'POST', headers: { 'Content-Type': 'application/json', 'x-api-key': localStorage.getItem(KEY)||'' }, body: JSON.stringify({ request, consciousnessState: state }) });
          out.textContent = JSON.stringify(await r.json(), null, 2);
        } catch (e) { out.textContent = String(e); }
      }
    </script>
  </body>
  </html>

